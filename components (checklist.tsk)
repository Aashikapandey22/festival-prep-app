import React, { useState } from 'react';
import { ChecklistItem, ThemeConfig } from '../types';
import { CheckCircle2, Circle, Leaf, Share2, Award } from 'lucide-react';

interface ChecklistProps {
  items: ChecklistItem[];
  theme: ThemeConfig;
  onToggle: (id: string) => void;
  budget: number;
}

const Checklist: React.FC<ChecklistProps> = ({ items, theme, onToggle, budget }) => {
  const [filter, setFilter] = useState<'All' | ChecklistItem['category']>('All');

  const categories = ['All', ...new Set(items.map(i => i.category))];
  const filteredItems = filter === 'All' ? items : items.filter(i => i.category === filter);
  const totalSpent = items.filter(i => i.isCompleted).reduce((sum, i) => sum + i.estimatedCost, 0);
  const progress = Math.round((items.filter(i => i.isCompleted).length / items.length) * 100) || 0;
  const budgetUsed = Math.min((totalSpent / budget) * 100, 100);

  return (
    <div className="w-full max-w-5xl mx-auto p-4 md:p-8 space-y-8 animate-in slide-in-from-bottom-10 duration-700 delay-200">
      
      {/* Progress & Stats Card */}
      <div className={`grid grid-cols-1 md:grid-cols-2 gap-6`}>
        {/* Task Progress */}
        <div className={`${theme.colors.cardBg} backdrop-blur-lg rounded-3xl p-6 border ${theme.colors.border} shadow-lg`}>
          <div className="flex justify-between items-center mb-4">
            <h3 className={`text-xl font-serif font-bold ${theme.colors.textMain}`}>Preparation Status</h3>
            <span className={`text-2xl font-bold ${theme.colors.primary}`}>{progress}%</span>
          </div>
          <div className="w-full bg-black/20 rounded-full h-3 overflow-hidden">
            <div 
              className={`h-full ${theme.colors.accent} transition-all duration-1000 ease-out`}
              style={{ width: `${progress}%` }}
            />
          </div>
          <p className={`mt-2 text-sm ${theme.colors.textMuted}`}>
            {progress === 100 ? "Ready for celebration! ðŸŽ‰" : `${items.filter(i => i.isCompleted).length} of ${items.length} tasks completed`}
          </p>
        </div>

        {/* Budget Tracker */}
        <div className={`${theme.colors.cardBg} backdrop-blur-lg rounded-3xl p-6 border ${theme.colors.border} shadow-lg relative overflow-hidden group`}>
           <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
              <Award className={`w-24 h-24 ${theme.colors.primary}`} />
           </div>
          <div className="flex justify-between items-center mb-4 relative z-10">
            <h3 className={`text-xl font-serif font-bold ${theme.colors.textMain}`}>Budget Tracker</h3>
            <span className={`text-lg font-mono ${theme.colors.secondary}`}>â‚¹{totalSpent} / â‚¹{budget}</span>
          </div>
          <div className="w-full bg-black/20 rounded-full h-3 overflow-hidden relative z-10">
            <div 
              className={`h-full ${budgetUsed > 90 ? 'bg-red-500' : 'bg-green-500'} transition-all duration-1000 ease-out`}
              style={{ width: `${budgetUsed}%` }}
            />
          </div>
          <div className="mt-4 flex gap-2 relative z-10">
              {budgetUsed <= 100 && (
                  <span className={`px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-400 border border-green-500/30`}>
                      Within Budget
                  </span>
              )}
               {progress > 50 && (
                  <span className={`px-3 py-1 rounded-full text-xs font-bold ${theme.colors.accent} ${theme.id === 'Holi' ? 'text-white' : 'text-black'} opacity-90`}>
                      On Track
                  </span>
              )}
          </div>
        </div>
      </div>

      {/* Main List Area */}
      <div className={`${theme.colors.cardBg} backdrop-blur-xl rounded-3xl p-6 md:p-8 border ${theme.colors.border} shadow-2xl min-h-[500px]`}>
        
        {/* Filter Tabs */}
        <div className="flex flex-wrap gap-2 mb-8 border-b border-gray-700/30 pb-4">
          {categories.map(cat => (
            <button
              key={cat}
              onClick={() => setFilter(cat as any)}
              className={`
                px-4 py-2 rounded-full text-sm font-medium transition-all
                ${filter === cat 
                  ? `${theme.colors.accent} ${theme.id === 'Holi' ? 'text-white' : 'text-slate-900'} shadow-lg scale-105` 
                  : `bg-black/20 ${theme.colors.textMuted} hover:bg-black/40`}
              `}
            >
              {cat}
            </button>
          ))}
        </div>

        {/* Items */}
        <div className="space-y-4">
          {filteredItems.map(item => (
            <div 
              key={item.id}
              onClick={() => onToggle(item.id)}
              className={`
                group flex items-start p-4 rounded-2xl border transition-all duration-300 cursor-pointer
                ${item.isCompleted 
                  ? `bg-black/10 border-transparent opacity-60` 
                  : `bg-black/20 ${theme.colors.border} hover:bg-black/30 hover:translate-x-1`}
              `}
            >
              {/* Checkbox */}
              <div className="mt-1 mr-4 shrink-0">
                {item.isCompleted ? (
                  <CheckCircle2 className={`w-6 h-6 ${theme.colors.primary} transition-transform duration-300 scale-110`} />
                ) : (
                  <Circle className={`w-6 h-6 ${theme.colors.textMuted} group-hover:${theme.colors.secondary}`} />
                )}
              </div>

              {/* Content */}
              <div className="flex-grow">
                <div className="flex justify-between items-start">
                    <h4 className={`text-lg font-medium ${item.isCompleted ? theme.colors.textMuted + ' line-through' : theme.colors.textMain}`}>
                    {item.task}
                    </h4>
                    <span className={`text-sm font-mono ${theme.colors.textMuted} whitespace-nowrap ml-4`}>
                        â‚¹{item.estimatedCost}
                    </span>
                </div>
                
                {/* Eco Tip */}
                {item.ecoTip && !item.isCompleted && (
                  <div className="mt-2 flex items-center gap-2 text-xs md:text-sm text-green-400/80 bg-green-900/10 p-2 rounded-lg inline-block">
                    <Leaf className="w-3 h-3 md:w-4 md:h-4" />
                    <span>Eco-Tip: {item.ecoTip}</span>
                  </div>
                )}
              </div>
            </div>
          ))}
          
          {filteredItems.length === 0 && (
            <div className={`text-center py-20 ${theme.colors.textMuted}`}>
              <p>No tasks in this category.</p>
            </div>
          )}
        </div>
      </div>
      
      {/* Share Button (Mock) */}
       <div className="flex justify-center pb-8">
          <button className={`flex items-center gap-2 px-6 py-3 rounded-full border ${theme.colors.border} ${theme.colors.textMain} hover:bg-white/10 transition-colors`}>
              <Share2 className="w-4 h-4" />
              <span>Share Checklist</span>
          </button>
       </div>
    </div>
  );
};

export default Checklist;
